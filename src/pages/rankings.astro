---
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import RankingsTable from "@/components/RankingsTable.astro";
import { tennisApi } from "@/lib/api/tennisApi";

// Get the ranking type from URL params, default to ATP
const rankingType = (Astro.url.searchParams.get('type') || 'ATP').toUpperCase() as 'ATP' | 'WTA';

let rankings;
let error;

try {
  if (rankingType === 'WTA') {
    rankings = await tennisApi.getWTARankings(100);
  } else {
    rankings = await tennisApi.getATPRankings(100);
  }
} catch (e) {
  error = e instanceof Error ? e.message : "Failed to load rankings";
  console.error("Rankings page error:", e);
}
---

<Layout title={`${rankingType} Rankings - Tennis Live`} description={`Live ${rankingType} Rankings Top 100`}>
  <Header />

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Page Header -->
    <div class="text-center mb-8">
      <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-4">
        <div class="inline-flex items-center gap-3">
          <span class="text-4xl" aria-hidden="true">üìä</span>
          <h1 class="text-heading-2">{rankingType} Rankings</h1>
        </div>

        <!-- Tour Toggle -->
        <div class="toggle-container">
          <a
            href="/rankings?type=ATP"
            class={`toggle-item ${
              rankingType === 'ATP'
                ? 'toggle-item-active-atp'
                : 'toggle-item-inactive'
            }`}
          >
            ATP
          </a>
          <a
            href="/rankings?type=WTA"
            class={`toggle-item ${
              rankingType === 'WTA'
                ? 'toggle-item-active-wta'
                : 'toggle-item-inactive'
            }`}
          >
            WTA
          </a>
        </div>
      </div>
      <p class="text-body-large max-w-4xl mx-auto">
        Top 100 players worldwide - Live rankings updated regularly
      </p>
    </div>

      {error ? (
        <div class="card bg-red-50 dark:bg-red-950/20 border-red-200 dark:border-red-800 p-6 text-center max-w-md mx-auto">
          <div class="text-4xl mb-4">‚ö†Ô∏è</div>
          <h3 class="text-lg font-semibold text-red-800 dark:text-red-200 mb-2">Error Loading Rankings</h3>
          <p class="text-red-600 dark:text-red-300 mb-4">{error}</p>
          <button
            onclick="window.location.reload()"
            class="btn-outline"
          >
            Try Again
          </button>
        </div>
      ) : rankings ? (
        <RankingsTable rankings={rankings} />
      ) : (
        <div class="text-center py-12">
          <div class="inline-block h-8 w-8 animate-spin rounded-full border-4 border-tennis-400 border-r-transparent mb-4"></div>
          <p class="text-body">Loading rankings...</p>
        </div>
      )}
    </div>
  </div>
</Layout>